(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();class l{constructor(){this.localVideo=document.getElementById("localVideo"),this.remoteVideo=document.getElementById("remoteVideo"),this.roomIdInput=document.getElementById("roomId"),this.createRoomBtn=document.getElementById("createRoom"),this.joinRoomBtn=document.getElementById("joinRoom"),this.leaveRoomBtn=document.getElementById("leaveRoom"),this.toggleVideoBtn=document.getElementById("toggleVideo"),this.toggleAudioBtn=document.getElementById("toggleAudio"),this.shareScreenBtn=document.getElementById("shareScreen"),this.connectionStatus=document.getElementById("connectionStatus"),this.currentRoom=document.getElementById("currentRoom"),this.chatMessages=document.getElementById("chatMessages"),this.messageInput=document.getElementById("messageInput"),this.sendMessageBtn=document.getElementById("sendMessage"),this.localStream=null,this.remoteStream=null,this.peerConnection=null,this.dataChannel=null,this.currentRoomId=null,this.isVideoEnabled=!0,this.isAudioEnabled=!0,this.isScreenSharing=!1,this.isHost=!1,this.iceCandidates=[],this.secretKey="WebRTC-VideoChat-2025",this.servers={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]},this.init()}init(){this.setupEventListeners(),this.updateConnectionStatus("æœªè¿æ¥")}setupEventListeners(){this.createRoomBtn.addEventListener("click",()=>this.createRoom()),this.joinRoomBtn.addEventListener("click",()=>this.joinRoom()),this.leaveRoomBtn.addEventListener("click",()=>this.leaveRoom()),this.toggleVideoBtn.addEventListener("click",()=>this.toggleVideo()),this.toggleAudioBtn.addEventListener("click",()=>this.toggleAudio()),this.shareScreenBtn.addEventListener("click",()=>this.toggleScreenShare()),this.sendMessageBtn.addEventListener("click",()=>this.sendMessage()),this.messageInput.addEventListener("keypress",e=>{e.key==="Enter"&&this.sendMessage()})}async createRoom(){try{await this.startLocalStream(),await this.setupPeerConnection(),this.iceCandidates=[];const e=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(e),console.log("ğŸ” åˆ›å»ºçš„offer:",e),console.log("ğŸ” Offerç±»å‹:",typeof e),console.log("ğŸ” Offerå†…å®¹:",JSON.stringify(e,null,2)),this.updateConnectionStatus("ç­‰å¾…å¯¹æ–¹åŠ å…¥"),this.addChatMessage("ç³»ç»Ÿ","ğŸ‰ æˆ¿é—´åˆ›å»ºä¸­..."),setTimeout(()=>{const t={offer:e,iceCandidates:this.iceCandidates||[]},o=this.encryptOffer(t);this.roomIdInput.value=o,this.currentRoomId=o,this.isHost=!0,this.currentRoom.textContent=`æˆ¿é—´: ${o.substring(0,8)}...`,this.toggleRoomButtons(!0),this.addChatMessage("ç³»ç»Ÿ","ğŸ‰ æˆ¿é—´åˆ›å»ºæˆåŠŸï¼"),this.addChatMessage("ç³»ç»Ÿ",`ğŸ”‘ æˆ¿é—´å¯†ç : ${o}`),this.addChatMessage("ç³»ç»Ÿ","ğŸ’¡ è¯·å°†æ­¤å¯†ç åˆ†äº«ç»™å…¶ä»–äººï¼Œä»–ä»¬è¾“å…¥å¯†ç å³å¯åŠ å…¥ï¼"),this.addChatMessage("ç³»ç»Ÿ",`ğŸ”„ å·²æ”¶é›† ${this.iceCandidates.length} ä¸ªICEå€™é€‰`),console.log(`âœ… æˆ¿é—´å·²åˆ›å»ºï¼Œå¯†ç : ${o}`),console.log(`ğŸ”„ æ”¶é›†åˆ° ${this.iceCandidates.length} ä¸ªICEå€™é€‰`)},3e3)}catch(e){console.error("åˆ›å»ºæˆ¿é—´å¤±è´¥:",e),this.addChatMessage("ç³»ç»Ÿ","âŒ åˆ›å»ºæˆ¿é—´å¤±è´¥: "+e.message)}}async joinRoom(){try{const e=this.roomIdInput.value.trim();if(!e){alert("è¯·è¾“å…¥æˆ¿é—´å¯†ç ");return}const t=this.decryptToken(e);if(!t||!t.offer){alert("âŒ æˆ¿é—´å¯†ç æ— æ•ˆï¼è¯·æ£€æŸ¥å¯†ç æ˜¯å¦æ­£ç¡®ã€‚");return}if(this.isHost=!1,await this.startLocalStream(),await this.setupPeerConnection(),this.currentRoomId=e,this.updateConnectionStatus("æ­£åœ¨è¿æ¥"),this.currentRoom.textContent=`æˆ¿é—´: ${e.substring(0,8)}...`,this.toggleRoomButtons(!0),this.addChatMessage("ç³»ç»Ÿ","ğŸ” æ­£åœ¨åŠ å…¥æˆ¿é—´..."),console.log("ğŸ” å‡†å¤‡è®¾ç½®è¿œç¨‹offer:",t.offer),console.log("ğŸ” Offerç±»å‹:",typeof t.offer),console.log("ğŸ” Offerå†…å®¹:",JSON.stringify(t.offer,null,2)),!t.offer||!t.offer.type||!t.offer.sdp)throw new Error("æ— æ•ˆçš„offeræ ¼å¼ï¼šç¼ºå°‘typeæˆ–sdpå­—æ®µ");if(await this.peerConnection.setRemoteDescription(t.offer),t.iceCandidates&&t.iceCandidates.length>0){console.log(`ğŸ”„ å¤„ç† ${t.iceCandidates.length} ä¸ªICEå€™é€‰`);for(const s of t.iceCandidates)try{await this.peerConnection.addIceCandidate(s),console.log("âœ… ICEå€™é€‰æ·»åŠ æˆåŠŸ")}catch(n){console.error("âŒ ICEå€™é€‰æ·»åŠ å¤±è´¥:",n)}}this.iceCandidates=[];const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o),this.addChatMessage("ç³»ç»Ÿ","ğŸ¤ æ­£åœ¨å»ºç«‹è¿æ¥..."),setTimeout(async()=>{const s={answer:o,iceCandidates:this.iceCandidates||[]},n=this.encryptAnswer(s);this.addChatMessage("ç³»ç»Ÿ",`ğŸ“‹ Answerå¯†ç : ${n}`),this.addChatMessage("ç³»ç»Ÿ","ğŸ’¡ è¯·å°†æ­¤Answerå¯†ç å‘é€ç»™æˆ¿é—´åˆ›å»ºè€…"),this.addChatMessage("ç³»ç»Ÿ",`ğŸ“ åˆ›å»ºè€…è¿è¡Œ: window.videoChat.acceptAnswer("${n}")`),this.addChatMessage("ç³»ç»Ÿ",`ğŸ”„ å·²æ”¶é›† ${this.iceCandidates.length} ä¸ªICEå€™é€‰`),console.log("ğŸ“‹ Answerå¯†ç :",n),console.log("ğŸ’¡ æˆ¿é—´åˆ›å»ºè€…è¯·è¿è¡Œ:",`window.videoChat.acceptAnswer("${n}")`),console.log(`ğŸ”„ æ”¶é›†åˆ° ${this.iceCandidates.length} ä¸ªICEå€™é€‰`)},3e3)}catch(e){console.error("åŠ å…¥æˆ¿é—´å¤±è´¥:",e),this.addChatMessage("ç³»ç»Ÿ","âŒ åŠ å…¥æˆ¿é—´å¤±è´¥: "+e.message)}}async leaveRoom(){this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null),this.localStream&&(this.localStream.getTracks().forEach(e=>e.stop()),this.localStream=null),this.localVideo.srcObject=null,this.remoteVideo.srcObject=null,this.currentRoomId=null,this.isHost=!1,this.updateConnectionStatus("æœªè¿æ¥"),this.currentRoom.textContent="",this.toggleRoomButtons(!1),this.addChatMessage("ç³»ç»Ÿ","ğŸ‘‹ å·²ç¦»å¼€æˆ¿é—´")}async startLocalStream(){try{const e={video:!0,audio:!0};this.localStream=await navigator.mediaDevices.getUserMedia(e),this.localVideo.srcObject=this.localStream,this.localVideo.autoplay=!0,this.localVideo.playsInline=!0,this.localVideo.muted=!0,console.log("âœ… æœ¬åœ°åª’ä½“æµè·å–æˆåŠŸ"),console.log("ğŸ“º è§†é¢‘è½¨é“:",this.localStream.getVideoTracks().length),console.log("ğŸ”Š éŸ³é¢‘è½¨é“:",this.localStream.getAudioTracks().length)}catch(e){throw console.error("è·å–æœ¬åœ°åª’ä½“æµå¤±è´¥:",e),new Error("æ— æ³•è®¿é—®æ‘„åƒå¤´å’Œéº¦å…‹é£")}}async setupPeerConnection(){this.peerConnection=new RTCPeerConnection(this.servers),this.localStream&&(this.localStream.getTracks().forEach(e=>{console.log(`ğŸ“¤ æ·»åŠ æœ¬åœ°è½¨é“: ${e.kind}`),this.peerConnection.addTrack(e,this.localStream)}),console.log("âœ… æ‰€æœ‰æœ¬åœ°è½¨é“å·²æ·»åŠ åˆ°PeerConnection")),this.peerConnection.ontrack=e=>{if(console.log("ğŸ“º æ¥æ”¶åˆ°è¿œç¨‹è§†é¢‘æµ",e),console.log("ğŸ“º Streams:",e.streams),console.log("ğŸ“º Track:",e.track),e.streams&&e.streams.length>0){this.remoteVideo.srcObject=e.streams[0],console.log("âœ… è¿œç¨‹è§†é¢‘æµè®¾ç½®æˆåŠŸ");const t=e.streams[0];console.log("ğŸ“Š è¿œç¨‹æµä¿¡æ¯:"),console.log("  - è§†é¢‘è½¨é“æ•°é‡:",t.getVideoTracks().length),console.log("  - éŸ³é¢‘è½¨é“æ•°é‡:",t.getAudioTracks().length),console.log("  - æµID:",t.id),console.log("  - æµæ´»è·ƒçŠ¶æ€:",t.active)}else e.track&&(this.remoteStream||(this.remoteStream=new MediaStream,this.remoteVideo.srcObject=this.remoteStream),this.remoteStream.addTrack(e.track),console.log("âœ… è¿œç¨‹trackæ·»åŠ æˆåŠŸ"),console.log("ğŸ“Š è½¨é“ä¿¡æ¯:",e.track.kind,e.track.id));this.remoteVideo.autoplay=!0,this.remoteVideo.playsInline=!0,this.remoteVideo.play().catch(t=>{console.log("è¿œç¨‹è§†é¢‘è‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œç”¨æˆ·éœ€è¦æ‰‹åŠ¨ç‚¹å‡»æ’­æ”¾:",t),this.addChatMessage("ç³»ç»Ÿ","ğŸ¥ è¿œç¨‹è§†é¢‘å·²å°±ç»ªï¼Œå¦‚æ— æ³•è‡ªåŠ¨æ’­æ”¾è¯·æ‰‹åŠ¨ç‚¹å‡»æ’­æ”¾æŒ‰é’®")}),this.remoteVideo.addEventListener("loadedmetadata",()=>{console.log("âœ… è¿œç¨‹è§†é¢‘å…ƒæ•°æ®åŠ è½½å®Œæˆ"),console.log(`ğŸ“ è§†é¢‘å°ºå¯¸: ${this.remoteVideo.videoWidth} x ${this.remoteVideo.videoHeight}`)}),this.remoteVideo.addEventListener("loadeddata",()=>{console.log("âœ… è¿œç¨‹è§†é¢‘æ•°æ®åŠ è½½å®Œæˆ")}),this.remoteVideo.addEventListener("playing",()=>{console.log("âœ… è¿œç¨‹è§†é¢‘å¼€å§‹æ’­æ”¾")}),this.updateConnectionStatus("âœ… å·²è¿æ¥"),this.addChatMessage("ç³»ç»Ÿ","ğŸ¥ è§†é¢‘é€šè¯å·²å»ºç«‹")},this.peerConnection.onicecandidate=e=>{e.candidate?(console.log("ğŸ”„ æ”¶é›†åˆ°ICEå€™é€‰:",e.candidate.candidate),this.iceCandidates||(this.iceCandidates=[]),this.iceCandidates.push(e.candidate)):console.log("ğŸ”„ ICEå€™é€‰æ”¶é›†å®Œæˆ")},this.peerConnection.onconnectionstatechange=()=>{const e=this.peerConnection.connectionState;switch(console.log("ğŸ”— è¿æ¥çŠ¶æ€:",e),e){case"connected":this.updateConnectionStatus("âœ… å·²è¿æ¥");break;case"connecting":this.updateConnectionStatus("ğŸ”„ è¿æ¥ä¸­");break;case"disconnected":this.updateConnectionStatus("âš ï¸ è¿æ¥æ–­å¼€");break;case"failed":this.updateConnectionStatus("âŒ è¿æ¥å¤±è´¥");break}},this.setupDataChannel()}setupDataChannel(){this.dataChannel=this.peerConnection.createDataChannel("chat",{ordered:!0}),this.dataChannel.onopen=()=>{console.log("ğŸ’¬ èŠå¤©é€šé“å·²å¼€å¯")},this.dataChannel.onmessage=e=>{const t=JSON.parse(e.data);this.addChatMessage(t.sender,t.text,!1)},this.peerConnection.ondatachannel=e=>{const t=e.channel;t.onmessage=o=>{const s=JSON.parse(o.data);this.addChatMessage(s.sender,s.text,!1)}}}async toggleVideo(){if(this.localStream){const e=this.localStream.getVideoTracks()[0];e&&(e.enabled=!e.enabled,this.isVideoEnabled=e.enabled,this.toggleVideoBtn.textContent=this.isVideoEnabled?"ğŸ“· å…³é—­æ‘„åƒå¤´":"ğŸ“· å¼€å¯æ‘„åƒå¤´",this.addChatMessage("ç³»ç»Ÿ",this.isVideoEnabled?"ğŸ“· æ‘„åƒå¤´å·²å¼€å¯":"ğŸ“· æ‘„åƒå¤´å·²å…³é—­"))}}async toggleAudio(){if(this.localStream){const e=this.localStream.getAudioTracks()[0];e&&(e.enabled=!e.enabled,this.isAudioEnabled=e.enabled,this.toggleAudioBtn.textContent=this.isAudioEnabled?"ğŸ”‡ é™éŸ³":"ğŸ”Š å–æ¶ˆé™éŸ³",this.addChatMessage("ç³»ç»Ÿ",this.isAudioEnabled?"ğŸ”Š éº¦å…‹é£å·²å¼€å¯":"ğŸ”‡ éº¦å…‹é£å·²é™éŸ³"))}}async toggleScreenShare(){try{if(this.isScreenSharing)this.stopScreenShare();else{const e=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}),t=e.getVideoTracks()[0],o=this.peerConnection.getSenders().find(s=>s.track&&s.track.kind==="video");o&&await o.replaceTrack(t),this.localVideo.srcObject=e,this.shareScreenBtn.textContent="ğŸ“º åœæ­¢åˆ†äº«",this.isScreenSharing=!0,this.addChatMessage("ç³»ç»Ÿ","ğŸ“º å¼€å§‹åˆ†äº«å±å¹•"),t.onended=()=>{this.stopScreenShare()}}}catch(e){console.error("å±å¹•åˆ†äº«å¤±è´¥:",e),this.addChatMessage("ç³»ç»Ÿ","å±å¹•åˆ†äº«å¤±è´¥: "+e.message)}}async stopScreenShare(){try{const e=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),t=e.getVideoTracks()[0],o=this.peerConnection.getSenders().find(s=>s.track&&s.track.kind==="video");o&&await o.replaceTrack(t),this.localVideo.srcObject=e,this.localStream=e,this.shareScreenBtn.textContent="ğŸ“º åˆ†äº«å±å¹•",this.isScreenSharing=!1,this.addChatMessage("ç³»ç»Ÿ","ğŸ“· å·²åˆ‡æ¢å›æ‘„åƒå¤´")}catch(e){console.error("åœæ­¢å±å¹•åˆ†äº«å¤±è´¥:",e)}}sendMessage(){const e=this.messageInput.value.trim();if(e&&this.dataChannel&&this.dataChannel.readyState==="open"){const t={sender:"æˆ‘",text:e,timestamp:new Date().toLocaleTimeString()};this.dataChannel.send(JSON.stringify(t)),this.addChatMessage("æˆ‘",e,!0),this.messageInput.value=""}else e&&(this.addChatMessage("æˆ‘",e,!0),this.messageInput.value="",this.addChatMessage("ç³»ç»Ÿ","âš ï¸ èŠå¤©åŠŸèƒ½éœ€è¦å»ºç«‹è¿æ¥åä½¿ç”¨"))}addChatMessage(e,t,o=!1){const s=document.createElement("div");s.className=`message ${o?"local":"remote"}`;const n=new Date().toLocaleTimeString();s.innerHTML=`
            <div class="message-text">${t}</div>
            <div class="timestamp">${e} - ${n}</div>
        `,this.chatMessages.appendChild(s),this.chatMessages.scrollTop=this.chatMessages.scrollHeight}updateConnectionStatus(e){this.connectionStatus.textContent=e,e.includes("å·²è¿æ¥")||e.includes("âœ…")?this.connectionStatus.className="connected":e.includes("è¿æ¥")||e.includes("ğŸ”„")?this.connectionStatus.className="connecting":this.connectionStatus.className="disconnected"}toggleRoomButtons(e){this.createRoomBtn.disabled=e,this.joinRoomBtn.disabled=e,this.leaveRoomBtn.disabled=!e,this.roomIdInput.disabled=e}generateRoomPassword(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="";for(let o=0;o<6;o++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}encryptOffer(e){try{console.log("ğŸ” åŠ å¯†æˆ¿é—´æ•°æ®:",e);const t={offer:e.offer||e,iceCandidates:e.iceCandidates||this.iceCandidates||[],timestamp:Date.now()};console.log("ğŸ” æœ€ç»ˆåŠ å¯†æ•°æ®:",t);const o=JSON.stringify(t),s=btoa(unescape(encodeURIComponent(o+"|"+t.timestamp)));return`ROOM_${this.simpleHash(s+this.secretKey).substring(0,8)}_${s}`}catch(t){return console.error("åŠ å¯†å¤±è´¥:",t),`SIMPLE_${btoa(JSON.stringify(e))}`}}decryptToken(e){try{if(e.startsWith("ROOM_")){const t=e.split("_");if(t.length!==3)return null;const o=t[1],s=t[2],n=this.simpleHash(s+this.secretKey).substring(0,8);if(o!==n)return console.error("æ ¡éªŒç éªŒè¯å¤±è´¥"),null;const i=decodeURIComponent(escape(atob(s))),[c,d]=i.split("|"),a=JSON.parse(c||i);return console.log("ğŸ” è§£å¯†æ•°æ®:",a),a.offer&&typeof a.offer=="object"?{offer:a.offer,iceCandidates:a.iceCandidates||[]}:a.type&&a.sdp?{offer:a,iceCandidates:[]}:null}else if(e.startsWith("SIMPLE_")){const t=e.substring(7);return{offer:JSON.parse(atob(t)),iceCandidates:[]}}return null}catch(t){return console.error("è§£å¯†å¤±è´¥:",t),console.error("Token:",e),null}}showAnswerForHost(e){const t=this.encryptAnswer(e);console.log("ğŸ“‹ è¯·å°†ä»¥ä¸‹Answerå¯†ç å‘é€ç»™æˆ¿é—´åˆ›å»ºè€…ï¼š"),console.log(`Answerå¯†ç : ${t}`),this.addChatMessage("ç³»ç»Ÿ",`ğŸ“‹ Answerå¯†ç : ${t}`),this.addChatMessage("ç³»ç»Ÿ","ğŸ’¡ è¯·å°†æ­¤Answerå¯†ç å‘é€ç»™æˆ¿é—´åˆ›å»ºè€…"),this.addChatMessage("ç³»ç»Ÿ",`ğŸ“ åˆ›å»ºè€…è¿è¡Œ: window.videoChat.acceptAnswer("${t}")`)}encryptAnswer(e){try{console.log("ğŸ” åŠ å¯†Answeræ•°æ®:",e);const t={answer:e.answer||e,iceCandidates:e.iceCandidates||this.iceCandidates||[],timestamp:Date.now()};console.log("ğŸ” æœ€ç»ˆåŠ å¯†Answeræ•°æ®:",t);const o=JSON.stringify(t),s=btoa(unescape(encodeURIComponent(o+"|"+t.timestamp)));return`ANS_${this.simpleHash(s+this.secretKey).substring(0,8)}_${s}`}catch(t){return console.error("AnsweråŠ å¯†å¤±è´¥:",t),`SIMPLE_ANS_${btoa(JSON.stringify(e))}`}}decryptAnswerToken(e){try{if(e.startsWith("ANS_")){const t=e.split("_");if(t.length!==3)return null;const o=t[1],s=t[2],n=this.simpleHash(s+this.secretKey).substring(0,8);if(o!==n)return console.error("Answeræ ¡éªŒç éªŒè¯å¤±è´¥"),null;const i=decodeURIComponent(escape(atob(s))),[c,d]=i.split("|"),a=JSON.parse(c||i);return console.log("ğŸ” è§£å¯†Answeræ•°æ®:",a),a.answer&&typeof a.answer=="object"?{answer:a.answer,iceCandidates:a.iceCandidates||[]}:a.type&&a.sdp?{answer:a,iceCandidates:[]}:null}else if(e.startsWith("SIMPLE_ANS_")){const t=e.substring(11);return{answer:JSON.parse(atob(t)),iceCandidates:[]}}return null}catch(t){return console.error("Answerè§£å¯†å¤±è´¥:",t),console.error("Token:",e),null}}simpleHash(e){let t=0;if(e.length===0)return t.toString();for(let o=0;o<e.length;o++){const s=e.charCodeAt(o);t=(t<<5)-t+s,t=t&t}return Math.abs(t).toString(16)}async acceptAnswer(e){try{const t=this.decryptAnswerToken(e);if(!t||!t.answer){this.addChatMessage("ç³»ç»Ÿ","âŒ æ— æ•ˆçš„Answerå¯†ç ï¼");return}if(await this.peerConnection.setRemoteDescription(t.answer),t.iceCandidates&&t.iceCandidates.length>0){console.log(`ğŸ”„ å¤„ç† ${t.iceCandidates.length} ä¸ªICEå€™é€‰`);for(const o of t.iceCandidates)try{await this.peerConnection.addIceCandidate(o),console.log("âœ… ICEå€™é€‰æ·»åŠ æˆåŠŸ")}catch(s){console.error("âŒ ICEå€™é€‰æ·»åŠ å¤±è´¥:",s)}}this.addChatMessage("ç³»ç»Ÿ","âœ… è¿æ¥å»ºç«‹æˆåŠŸï¼"),console.log("âœ… è¿æ¥å·²å»ºç«‹")}catch(t){console.error("æ¥å—Answerå¤±è´¥:",t),this.addChatMessage("ç³»ç»Ÿ","âŒ è¿æ¥å¤±è´¥: "+t.message)}}updateTokenWithIce(){this.isHost&&this.iceCandidates.length>0&&console.log(`ğŸ”„ æ”¶é›†åˆ° ${this.iceCandidates.length} ä¸ªICEå€™é€‰`)}async handleIceCandidates(e){if(e&&Array.isArray(e))for(const t of e)try{await this.peerConnection.addIceCandidate(t),console.log("âœ… æ·»åŠ ICEå€™é€‰æˆåŠŸ")}catch(o){console.error("âŒ æ·»åŠ ICEå€™é€‰å¤±è´¥:",o)}}}document.addEventListener("DOMContentLoaded",()=>{window.videoChat=new l,console.log("ğŸ¥ WebRTCè§†é¢‘èŠå¤©åº”ç”¨å·²åˆå§‹åŒ–"),console.log("ğŸ’¡ ä½¿ç”¨è¯´æ˜ï¼š"),console.log('1. åˆ›å»ºè€…ï¼šç‚¹å‡»"åˆ›å»ºæˆ¿é—´"ç”ŸæˆåŠ å¯†å¯†ç '),console.log('2. åŠ å…¥è€…ï¼šè¾“å…¥å¯†ç ç‚¹å‡»"åŠ å…¥æˆ¿é—´"'),console.log("3. åŠ å…¥è€…ä¼šçœ‹åˆ°Answerå¯†ç ï¼Œå‘é€ç»™åˆ›å»ºè€…"),console.log('4. åˆ›å»ºè€…è¿è¡Œ: window.videoChat.acceptAnswer("Answerå¯†ç ")')});window.acceptAnswer=r=>{window.videoChat&&window.videoChat.isHost?window.videoChat.acceptAnswer(r):console.error("âŒ åªæœ‰æˆ¿é—´åˆ›å»ºè€…å¯ä»¥æ¥å—Answerï¼Œæˆ–è€…åº”ç”¨å°šæœªåˆå§‹åŒ–")};
